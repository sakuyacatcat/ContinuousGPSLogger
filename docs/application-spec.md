# ContinuousGPSLogger アプリケーション仕様書

## 概要

ContinuousGPSLogger は、iOS デバイスで継続的な GPS 位置情報の取得・記録を行うアプリケーションです。3 つの異なる GPS 取得戦略を提供し、ユーザーが用途に応じて最適な方式を選択できます。

## 主な機能

### 1. GPS 位置情報の継続取得

- 3 つの取得戦略（Standard、Significant、Region Monitoring）
- リアルタイムでの位置情報表示
- 自動的なデータ保存（最大 100 件）

### 2. 戦略切り替え機能

- アプリ実行中にリアルタイムで戦略変更可能
- 各戦略の統計情報表示
- 電力消費・精度・頻度の比較

### 3. バックグラウンド対応

- アプリがバックグラウンドでも位置取得継続
- アプリキル後の復旧システム
- 電源 OFF 後の継続取得（戦略依存）

### 4. データ管理

- Core Data による永続化
- FIFO 方式での自動データ制限（100 件）
- 履歴画面での取得データ確認

## システム要件

- iOS 15.0 以上
- 位置情報権限（Always 推奨）
- Background App Refresh 有効（推奨）

## データ仕様

### 保存データ項目

- 緯度・経度
- 精度（horizontal accuracy）
- 速度
- タイムスタンプ
- 標高（利用可能な場合）

### データ制限

- 最大保存件数：100 件
- 超過時の処理：FIFO（古いデータから削除）

## 権限要件

### 必須権限

- 位置情報アクセス権限（When In Use）

### 推奨権限

- 位置情報アクセス権限（Always）
  - バックグラウンド位置取得に必要
  - アプリキル後の復旧に必要

### システム設定

- Background App Refresh：有効推奨
- 低電力モード：無効推奨（精度向上のため）

## アーキテクチャ

### 主要コンポーネント

1. **LocationService**: GPS 取得のメイン制御
2. **PersistenceService**: データ永続化管理
3. **LocationAcquisitionStrategy**: 戦略パターン実装
4. **MainView**: メイン UI（戦略選択・状態表示）
5. **HistoryView**: 取得データ履歴表示

### デザインパターン

- **Strategy Pattern**: GPS 取得方式の切り替え
- **Observer Pattern**: @Published による状態監視
- **Singleton Pattern**: サービスクラスの共有

## 制限事項

### iOS システム制限

1. **アプリキル後の Standard Strategy**

   - システムにより GPS 取得停止
   - アプリ再起動まで復旧不可

2. **バックグラウンド実行時間**

   - 通常のバックグラウンド実行は数分程度
   - Significant/Region Monitoring は例外

3. **精度と電力のトレードオフ**
   - 高精度＝高電力消費
   - 低電力＝低精度・低頻度

### アプリ固有の制限

1. **データ保存上限**: 100 件（設計による）
2. **1Hz 制限**: フォアグラウンド時の Standard Strategy
3. **単一戦略**: 同時に複数戦略は実行不可

## セキュリティ・プライバシー

### データ保護

- 位置データはデバイス内のみ保存
- 外部サーバーへの送信なし
- Core Data による暗号化（iOS 標準）

### 権限管理

- 必要最小限の権限要求
- 権限状態のリアルタイム監視
- ユーザーフレンドリーな権限説明

## パフォーマンス仕様

### メモリ使用量

- 基本動作：約 10-20MB
- データ 100 件保存時：約 25MB
- Strategy 切り替え時の一時増加：約 5MB

### CPU 使用率

- フォアグラウンド時：1-3%
- バックグラウンド時：0.1-1%
- Strategy 切り替え時：短時間で 5-10%

### 電力消費（概算）

- Standard Strategy：高（GPS 常時稼働）
- Significant Strategy：低（システム制御）
- Region Monitoring：中（地域監視のみ）

## 更新履歴

### v1.0（現在）

- 基本 GPS 取得機能
- 3 戦略の実装
- Strategy 切り替え機能
- データ保存・履歴表示
- アプリキル後復旧システム

### 今後の予定

- 複数戦略同時実行
- データエクスポート機能
- 統計分析機能
- カスタムパラメータ設定
