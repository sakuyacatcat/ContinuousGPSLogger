# GPS 連続ロガーアプリ 段階的実装計画（UI 中心）

## 概要

このプランは、ビルドしながら動作確認できる段階的な実装計画です。各段階で UI の改善と機能追加を行い、テストを通じて動作を確認します。

## 全体目標

- アプリが起動している間は、GPS が取得でき、画面に表示し続ける
- アプリキルを行っても、GPS の取得が継続される
- 本体電源が OFF されている間は GPS を取得できないが、本体電源が ON されると GPS の取得が再開される
- GPS 取得した点の直近 100 点は、履歴として確認できる

## 段階 1: 現在の UI 改善と動作確認 ✅

**目標**: 現在のコードの動作確認と UI 改善（30 分）
**実装内容**:

- MainView に権限状態・位置取得状態を表示
- HistoryView の見た目を改善（時刻フォーマット、データ表示）
- エラー状態の適切な表示
- 位置情報の精度表示追加

**テスト項目**:

- シミュレーターでの基本動作確認
- UI 表示の確認
- 権限要求ダイアログの表示確認

**成功基準**:

- アプリが正常にビルドされる
- 位置情報が画面に表示される
- 権限状態が適切に表示される

## 段階 2: 権限管理の改善 ✅

**目標**: Always 権限要求と UI 連動（30 分）
**実装完了日**: 2025-07-06
**実装内容**:

- LocationService で Always 権限要求に変更
- 権限状態に応じた UI 表示（許可待ち、拒否時の案内）
- 設定画面へのナビゲーション機能
- 権限状態の詳細表示

**テスト項目**:

- 権限要求フローの確認
- 権限拒否時の適切な案内表示
- 設定画面への遷移確認

**成功基準**:

- Always 権限が適切に要求される
- 権限状態が UI に反映される
- 権限拒否時に適切な案内が表示される

## 段階 3: 自動データ保存の実装 ✅

**目標**: 位置更新時の自動保存（30 分）
**実装完了日**: 2025-07-06
**実装内容**:

- LocationService で位置更新時に PersistenceService へ自動保存
- リアルタイムで HistoryView に反映される機能
- 保存件数のカウント表示
- 最新の位置情報のタイムスタンプ表示

**テスト項目**:

- 位置変更時の自動保存確認
- HistoryView へのリアルタイム反映確認
- データ保存件数の正確性確認

**成功基準**:

- 位置更新時に自動的にデータが保存される
- 履歴画面にリアルタイムで反映される
- 保存件数が正確に表示される

## 段階 4: 履歴制限と最適化 ✅

**目標**: 100 件制限と古いデータ削除・手動削除機能（40 分）  
**実装完了日**: 2025-07-06
**実装内容**:

- HistoryView を 100 件に制限
- 古いデータの自動削除機能
- 手動削除機能（全削除、古いデータ削除）
- データ使用量の表示
- パフォーマンス最適化

**テスト項目**:

- 大量データでの動作確認
- 100 件制限の動作確認
- 古いデータ削除機能の確認
- 手動削除機能の確認

**成功基準**:

- 履歴表示が 100 件に制限される
- 古いデータが自動的に削除される
- 手動削除機能が正常に動作する
- 大量データでも快適に動作する

## 段階 5: バックグラウンド対応 ✅

**目標**: アプリ終了後も位置追跡継続（45 分）
**実装完了日**: 2025-07-06
**実装内容**:

- `allowsBackgroundLocationUpdates = true`の設定
- `startMonitoringSignificantLocationChanges()`の実装
- アプリ復帰時の状態確認機能
- バックグラウンド時の動作状態表示

**テスト項目**:

- アプリ終了後の位置追跡確認
- アプリ復帰時のデータ確認
- バックグラウンド動作の安定性確認

**成功基準**:

- アプリ終了後も位置追跡が継続される
- アプリ復帰時に新しい位置データが保存されている
- バックグラウンド動作が安定している

## 各段階での確認事項

- **ビルドエラーがないこと**
- **UI 表示が正常であること**
- **新機能が期待通りに動作すること**
- **既存機能が正常に動作すること**

## 実装時の注意事項

- 各段階でビルドして動作確認する
- 問題があれば次の段階に進む前に修正する
- UI の変更は段階的に行い、大幅な変更は避ける
- テストは実機とシミュレーターの両方で行う

## 最終目標

- 連続 GPS 追跡が可能なアプリの完成
- 直近 100 点の履歴表示機能
- アプリ終了後も位置追跡継続
- 電源 ON 時の自動復帰機能

---

**推定所要時間**: 約 3 時間
**前提条件**: 現在のコードベースが正常にビルドされること
**対象プラットフォーム**: iOS 18.0 以降
