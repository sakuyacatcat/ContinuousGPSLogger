# ContinuousGPSLogger 動作確認・テスト手順書

## 概要

このドキュメントは、ContinuousGPSLogger の各機能・戦略の動作確認方法とテスト手順を詳細に説明します。

---

## 事前準備

### 必要な環境

- **デバイス**: 実機の iOS デバイス（シミュレータでは位置情報取得不可）
- **iOS**: 15.0 以上
- **設定**: 位置情報サービス有効
- **アプリ権限**: Always 権限（推奨）

### 準備手順

1. **位置情報サービスを有効化**

   ```
   設定 > プライバシーとセキュリティ > 位置情報サービス > オン
   ```

2. **Background App Refresh を有効化**

   ```
   設定 > 一般 > Backgroundアプリの更新 > オン
   設定 > 一般 > Backgroundアプリの更新 > ContinuousGPSLogger > オン
   ```

3. **低電力モードを無効化**（テスト時）
   ```
   設定 > バッテリー > 低電力モード > オフ
   ```

---

## 基本機能の確認

### 1. アプリ起動・権限設定

#### 手順

1. アプリを初回起動
2. 位置情報権限ダイアログで「App の使用中は許可」を選択
3. Always 権限アップグレード画面で「Always 権限をリクエスト」をタップ
4. システムダイアログで「常に許可」を選択

#### 確認項目

- [ ] 権限状態が「常に許可」と表示される
- [ ] 位置取得状態が「取得中」と表示される
- [ ] 現在地セクションに緯度・経度が表示される
- [ ] 精度・速度情報が表示される

#### トラブルシューティング

- 権限が「使用中のみ許可」の場合：「Always 権限をリクエスト」ボタンを再度タップ
- 位置情報が表示されない場合：屋外に移動するか、WiFi 環境を確認

### 2. 基本位置取得

#### 手順

1. アプリをフォアグラウンドで起動
2. GPS 取得方式で「Standard Location Updates」を選択
3. 屋外で徒歩移動（約 50m）

#### 確認項目

- [ ] 現在地の緯度・経度が移動に伴い変化
- [ ] 更新時刻が 1 秒間隔で更新される
- [ ] 保存件数が増加する
- [ ] 最終保存時刻が更新される

---

## GPS 戦略別確認手順

### 1. Standard Location Updates Strategy

#### フォアグラウンド確認

**手順**:

1. 戦略選択で「Standard Location Updates」を選択
2. アプリをフォアグラウンドで起動
3. 徒歩または車で移動

**確認項目**:

- [ ] 約 1 秒間隔で位置更新（更新時刻確認）
- [ ] 高精度（精度表示が 10m 以下）
- [ ] 統計の更新回数が高頻度で増加
- [ ] 電力消費レベルが「最高」と表示

#### バックグラウンド確認

**手順**:

1. Standard Strategy を選択
2. アプリをバックグラウンドに移行（ホームボタン/スワイプ）
3. 約 5m 以上移動
4. アプリに戻って確認

**確認項目**:

- [ ] バックグラウンド中も位置更新継続
- [ ] 約 5m 移動ごとに更新
- [ ] 保存件数の増加
- [ ] 「Standard Strategy: バックグラウンド設定」のログ確認

#### アプリキル後確認

**手順**:

1. Standard Strategy で位置取得中
2. アプリを完全終了（アプリスイッチャーから削除）
3. 移動後、アプリを再起動

**確認項目**:

- [ ] キル中は位置取得停止（保存件数増加なし）
- [ ] 再起動時に自動復旧
- [ ] 「復旧試行」のログ確認

### 2. Significant Location Changes Strategy

#### 基本動作確認

**手順**:

1. 戦略選択で「Significant Location Changes」を選択
2. 長距離移動（500m 以上推奨）
3. 移動手段：徒歩、車、電車など

**確認項目**:

- [ ] 大幅な移動時のみ更新
- [ ] 更新頻度が低い（統計確認）
- [ ] 電力消費レベルが「低」と表示
- [ ] 更新頻度レベルが「極低」と表示

#### アプリキル後継続確認

**手順**:

1. Significant Strategy で位置取得開始
2. アプリを完全終了
3. 長距離移動（数 km 推奨）
4. アプリを起動して確認

**確認項目**:

- [ ] キル中も位置取得継続
- [ ] 移動中に保存件数が増加
- [ ] アプリ起動時に取得済みデータを確認
- [ ] 履歴画面でキル中のデータを確認

#### 電源 OFF 後確認

**手順**:

1. Significant Strategy を有効
2. デバイスの電源 OFF
3. 他の場所で電源 ON
4. アプリを起動

**確認項目**:

- [ ] 電源 OFF 中の移動が記録されている場合がある
- [ ] システムの位置情報サービスが有効な場合のみ
- [ ] 復旧ログに記録される

### 3. Region Monitoring Strategy

#### 基本動作確認

**手順**:

1. 戦略選択で「Region Monitoring」を選択
2. 100m 以上の移動を行う
3. 移動パターン：直線的な移動が理想

**確認項目**:

- [ ] 約 100m 移動時に更新
- [ ] 電力消費レベルが「中」と表示
- [ ] 「地域監視開始」「地域退出」のログ確認
- [ ] 統計の更新頻度が「低」〜「中」

#### 地域イベント確認

**手順**:

1. Region Monitoring を開始
2. バックグラウンド状態セクションの地域イベントログを確認
3. 移動しながらリアルタイム確認

**確認項目**:

- [ ] 「地域進入」イベントの記録
- [ ] 「地域退出」イベントの記録
- [ ] 「地域監視開始」イベントの記録
- [ ] イベント時刻の記録

#### アプリキル後継続確認

**手順**:

1. Region Monitoring 開始
2. アプリ完全終了
3. 100m 以上移動
4. アプリ起動して確認

**確認項目**:

- [ ] キル中も地域監視継続
- [ ] 地域出入り時にデータ記録
- [ ] 復旧ログの記録

---

## 戦略切り替え機能の確認

### リアルタイム切り替え

**手順**:

1. Standard Strategy で位置取得開始
2. 統計情報を確認（更新回数、稼働時間など）
3. Region Monitoring に切り替え
4. 統計情報の変化を確認

**確認項目**:

- [ ] 切り替え時に位置取得が中断されない
- [ ] 各戦略の統計が個別管理される
- [ ] 切り替え後の動作が新戦略に従う
- [ ] 「Strategy 変更」のログ確認

### 統計リセット機能

**手順**:

1. 任意の戦略で一定時間動作
2. 統計情報を確認
3. 「統計リセット」ボタンをタップ
4. 統計情報の変化を確認

**確認項目**:

- [ ] 更新回数が 0 にリセット
- [ ] 最終更新時刻がクリア
- [ ] 平均精度がリセット
- [ ] 稼働時間がリセット

---

## データ管理機能の確認

### FIFO 制限の確認

**手順**:

1. Standard Strategy で高頻度取得
2. 保存件数を 100 件近くまで増やす
3. さらに移動して 100 件を超過させる
4. 履歴画面で確認

**確認項目**:

- [ ] 100 件を超えない
- [ ] 古いデータから削除される
- [ ] 最新データが保持される
- [ ] 履歴画面で時系列順に表示

### 履歴画面の確認

**手順**:

1. 複数の戦略でデータを取得
2. 履歴画面を表示
3. データの内容を確認

**確認項目**:

- [ ] 緯度・経度の正確な表示
- [ ] タイムスタンプの表示
- [ ] 精度情報の表示
- [ ] 速度情報の表示（移動時）

---

## エラー・異常ケースの確認

### 権限拒否時の動作

**手順**:

1. 設定でアプリの位置情報権限を無効化
2. アプリを起動
3. エラー表示を確認

**確認項目**:

- [ ] 適切なエラーメッセージ表示
- [ ] 「設定を開く」ボタンの表示
- [ ] 位置取得状態が「停止中」
- [ ] 設定画面への誘導

### 位置情報サービス無効時

**手順**:

1. システム設定で位置情報サービスを無効化
2. アプリの動作を確認

**確認項目**:

- [ ] 適切なエラー処理
- [ ] GPS 取得の停止
- [ ] エラー状態の表示

### Background App Refresh 無効時

**手順**:

1. Background App Refresh を無効化
2. バックグラウンド動作を確認

**確認項目**:

- [ ] バックグラウンド制限の通知
- [ ] 推奨設定の案内
- [ ] 制限下での動作継続

---

## パフォーマンステスト

### 電力消費テスト

**手順**:

1. 各戦略で 1 時間ずつ動作
2. バッテリー使用量を記録
3. 設定 > バッテリー で確認

**比較項目**:

- Standard > Region > Significant の順で消費量大

### メモリ使用量テスト

**手順**:

1. Xcode の Instruments を使用
2. Memory 使用量を監視
3. 各戦略での使用量を比較

**確認項目**:

- [ ] 基本動作：10-20MB
- [ ] データ 100 件時：25MB 程度
- [ ] メモリリークなし

### CPU 使用率テスト

**手順**:

1. Instruments で CPU 監視
2. 各戦略での使用率を測定

**確認項目**:

- [ ] フォアグラウンド：1-3%
- [ ] バックグラウンド：0.1-1%
- [ ] 戦略切り替え時：短時間 5-10%

---

## 長期動作テスト

### 24 時間継続テスト

**手順**:

1. Significant Location Changes で開始
2. 24 時間後に結果確認
3. 各種統計とログを確認

**確認項目**:

- [ ] クラッシュなし
- [ ] データ正常保存
- [ ] メモリリークなし
- [ ] 適切な電力消費

### 戦略組み合わせテスト

**手順**:

1. 各戦略を数時間ずつ使用
2. 切り替えを繰り返す
3. 総合的な動作確認

**確認項目**:

- [ ] 切り替え時の安定性
- [ ] データ整合性
- [ ] 統計の正確性
- [ ] システムリソース使用量

---

## トラブルシューティング

### よくある問題と対処法

#### 位置情報が取得できない

1. **屋外に移動**: GPS 信号の受信改善
2. **WiFi 確認**: 位置情報精度向上
3. **権限確認**: Always 権限の設定確認
4. **再起動**: アプリまたはデバイスの再起動

#### バックグラウンドで動作しない

1. **Background App Refresh**: 設定確認
2. **低電力モード**: 無効化
3. **戦略選択**: Significant または Region を使用
4. **権限確認**: Always 権限必須

#### アプリキル後に復旧しない

1. **戦略確認**: Significant または Region 使用
2. **システム再起動**: iOS の再起動
3. **位置情報サービス**: システム設定確認
4. **アプリ再インストール**: 最終手段

#### データが保存されない

1. **ストレージ容量**: デバイス容量確認
2. **アプリ権限**: 必要権限の確認
3. **Core Data**: アプリデータのリセット
4. **ログ確認**: エラーログの確認

---

## テスト結果の記録

### テスト項目チェックリスト

#### 基本機能

- [ ] アプリ起動・権限設定
- [ ] 基本位置取得
- [ ] 戦略切り替え
- [ ] データ保存・表示

#### 各戦略テスト

- [ ] Standard Strategy（フォア・バック・キル後）
- [ ] Significant Strategy（基本・キル後・電源 OFF 後）
- [ ] Region Monitoring（基本・イベント・キル後）

#### エラーハンドリング

- [ ] 権限拒否時
- [ ] サービス無効時
- [ ] Background App Refresh 無効時

#### パフォーマンス

- [ ] 電力消費測定
- [ ] メモリ使用量測定
- [ ] CPU 使用率測定

#### 長期テスト

- [ ] 24 時間継続動作
- [ ] 戦略組み合わせテスト

### テスト環境記録

**記録項目**:

- iOS バージョン: \***\*\_\_\_\*\***
- デバイスモデル: \***\*\_\_\_\*\***
- アプリバージョン: \***\*\_\_\_\*\***
- テスト実施日: \***\*\_\_\_\*\***
- テスト実施者: \***\*\_\_\_\*\***
- 特記事項: \***\*\_\_\_\*\***
